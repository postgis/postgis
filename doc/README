PostGIS Documentation
=====================

Overview
--------

PostGIS documentation is written in DocBook XML. The input file is
``postgis.xml``, which in turn includes all the individual chapter XML files.
From that file we can publish several formats, including HTML and PDF.

Make targets
------------

``make``
  same as ``make comments``

``make install``
  same as ``make comments-install``

``make uninstall``
  same as ``make comments-uninstall``

``make html``
  generates a single-file ``html/postgis.html``

``make html-localized``
  generates single-file ``html/postgis-<lang>.html`` for
  each supported language

``make chunked-html``
  generates a separate html file for every chapter or section break
  You can use CHUNKED_HTML_USER_OPTS environment variable to tweak
  the output, for example:
  > make chunked-html XSLTPROCFLAGS="--stringparam html.script custom.js

``make pdf``
  generates a single PDF file with the PostGIS version as a filename

``make pdf-localized``
  generates a single PDF file with the PostGIS version as a filename
  and ``-<lang>`` suffix for each supported language

``make images``
  generates all the images used in the HTML and PDF targets

``make comments``
  generates an SQL script that add COMMENTs for every function (derived from
  the documentation)

``make doxygen``
  generates the developer's documentation using Doxygen

``make comments-install``
  copies the ``postgis-comments.sql`` script to the PostgreSQL ``contrib``
  directory

``make comments-uninstall``
  removes the ``postgis-comments.sql`` script from the ``contrib`` directory

``make clean``
  removes generated files except comments

``make maintainer-clean``
  removes all generated files (including comments)

``make update-po``
  update translation files to be in sync with the source
  XML files. See ``make check-localized``

``make check``
  check structural correctness of XML documentation

``make check-localized``
  check structural correctness of localized (translated)
  XML documentation. Remember to run this before committing
  updates to translation files (see ``make update-po``)


Requirements
------------

To generate the html files and the comments:
 * xsltproc - http://xmlsoft.org/xslt/xsltproc2.html
 * DocBook 5 schemas and stylesheets - https://docbook.org/tools/
 * xmllint - http://xmlsoft.org

To generate the images:
 * GraphicsMagick - http://www.graphicsmagick.org/ (preferred)
 * ImageMagick - https://imagemagick.org/script/download.php ("convert" or
   "magick convert" binaries)

To generate the PDFs:
 * dblatex - http://dblatex.sourceforge.net

To generate the developer's documentation:
 * Doxygen - http://www.stack.nl/~dimitri/doxygen/
 * Graphviz - http://www.graphviz.org/

To generate and manage the translated XML files:
 * poxml - https://github.com/KDE/poxml
 * gettext - https://www.gnu.org/software/gettext/

To generate the localized PDFs:
 * fonts-ipafont-gothic
 * fonts-ipafont-mincho

How to
------

Manual images for the reference documentation live in ``doc/html/images``.
Each ``.wkt`` file stores one drawing, optionally split into named layers by
prefixing a line with ``StyleName;WKT``. The generator associates each layer
with ``styles.conf`` and streams the resulting GraphicsMagick command without
ever writing intermediate files, so building all figures in parallel is safe.

To regenerate the helper binary and PNG artwork:

1. ``make -C doc/html/images generator``
2. ``make -C doc/html/images`` (use ``-j`` for parallel builds)

Invoke ``doc/html/images/generator`` directly to spot-check new artwork. The
``-v`` flag prints the exact GraphicsMagick or ImageMagick command, ``-s``
overrides the canvas size, and passing a second filename overrides the default
``.png`` output. Set ``POSTGIS_DOC_CONVERTER`` to the GraphicsMagick/ImageMagick
binary if autodetection cannot find ``gm``, ``magick``, or ``convert`` in
``PATH``.

To run garden tests against functions, follow these instructions on the PostGIS
dev wiki: http://trac.osgeo.org/postgis/wiki/DevWikiGardenTest
