
<refentry id="ST_AsKML">
    <refnamediv>
        <refname>ST_AsMARC21</refname>
        <refpurpose>Return the geometry as a MARC21/XML record with a geographic datafield (034).</refpurpose>
    </refnamediv>

    <refsynopsisdiv>
        <funcsynopsis>

            <funcprototype>
                <funcdef>
                    text
                    <function>ST_AsMARC21</function>
                </funcdef>
                <paramdef>
                    <type>geometry </type>
                    <parameter>geom</parameter>
                </paramdef>
                <paramdef choice="opt">
                    <type>integer </type>
                    <parameter>precision=15</parameter>
                </paramdef>
            </funcprototype>

        </funcsynopsis>
    </refsynopsisdiv>

    <refsection>
        <title>Description</title>

        <para>Return the geometry bounding box as a MARC21/XML <ulink url="https://www.loc.gov/marc/bibliographic/bd034.html">Coded Cartographic Mathematical Data</ulink>. The coordinates in subfields <varname>$d</varname>,<varname>$e</varname>,<varname>$f</varname> and <varname>$g</varname> will be encoded as decimal degrees.</para>
        <para>It ignores the Z and M dimensions.</para>

        <para>
            LOC MARC21/XML versions supported:
            <itemizedlist>
                <listitem>
                    <para><ulink url="https://www.loc.gov/standards/marcxml/">MARC21/XML 1.1</ulink></para>
                </listitem>
            </itemizedlist>
        </para>

        <para>Availability: 3.3.0 </para>
        
        <warning>
            <para>
                As of January 2022, the MARC21/XML Standard does not provide any means to annotate the coordinates spatial reference system. If needed, use <xref linkend="ST_SRID"/> straight from the geometry.
            </para>
        </warning>

        <note>
            <para>This function only works with lon/lat geometries, as dictated by the MARC21/XML Standard.</para>
        </note>

    </refsection>

    <refsection>
        <title>Examples</title>
        
        <para>Converting a <varname>POINT</varname> to MARC21/XML with 4 decimal precision</para>
        <programlisting><![CDATA[
        
            SELECT ST_AsMARC21('SRID=4326;POINT(-4.504289 54.253312)'::geometry,4);
            
                              st_asmarc21                                                                                                                              
            -------------------------------------------------
            <record xmlns="http://www.loc.gov/MARC21/slim">
                <datafield tag="034" ind1="1" ind2=" ">
                    <subfield code="a">a</subfield>
                    <subfield code="d">-004.5043</subfield>
                    <subfield code="e">-004.5043</subfield>
                    <subfield code="f">054.2533</subfield>
                    <subfield code="g">054.2533</subfield>
                </datafield>
            </record>
            
            (1 row)
        ]]>
        </programlisting>
        
        <para>Converting a <varname>POLYGON</varname> to MARC21/XML with 4 decimal precision</para>
        <programlisting><![CDATA[
        
            SELECT ST_AsMARC21('SRID=4326;POLYGON((-4.5792388916015625 54.18172660239091,-4.56756591796875 54.196993557130355,-4.546623229980469 54.18313300502024,-4.5792388916015625 54.18172660239091))'::geometry,4);
            
                              st_asmarc21                                                                                                                              
            -------------------------------------------------
            <record xmlns="http://www.loc.gov/MARC21/slim">
                <datafield tag="034" ind1="1" ind2=" ">
                    <subfield code="a">a</subfield>
                    <subfield code="d">-004.5792</subfield>
                    <subfield code="e">-004.5466</subfield>
                    <subfield code="f">054.1970</subfield>
                    <subfield code="g">054.1817</subfield>
                </datafield>
            </record>


        ]]>
        </programlisting>
        
        <para>Converting a <varname>GEOMETRYCOLLECTION</varname> to MARC21/XML with 4 decimal precision. The geometries order in the MARC21/XML output correspond to their order in the collection.</para>
        <programlisting><![CDATA[
        
            SELECT ST_AsMARC21('SRID=4326;GEOMETRYCOLLECTION(POLYGON((13.1 52.65,13.516666666666667 52.65,13.516666666666667 52.38333333333333,13.1 52.38333333333333,13.1 52.65)),POINT(-4.5 54.25))'::geometry,4);
            
                              st_asmarc21                                                                                                                              
            -------------------------------------------------
            <record xmlns="http://www.loc.gov/MARC21/slim">
                <datafield tag="034" ind1="1" ind2=" ">
                    <subfield code="a">a</subfield>
                    <subfield code="d">013.1000</subfield>
                    <subfield code="e">013.5167</subfield>
                    <subfield code="f">052.6500</subfield>
                    <subfield code="g">052.3833</subfield>
                </datafield>
                <datafield tag="034" ind1="1" ind2=" ">
                    <subfield code="a">a</subfield>
                    <subfield code="d">-004.5000</subfield>
                    <subfield code="e">-004.5000</subfield>
                    <subfield code="f">054.2500</subfield>
                    <subfield code="g">054.2500</subfield>
                </datafield>
            </record>

        ]]>
        </programlisting>
        
    </refsection>
    <refsection>
        <title>See Also</title>
        <para><xref linkend="ST_GeomFromMARC21" /></para>
    </refsection>
</refentry>

