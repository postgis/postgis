<?xml version="1.0" encoding="UTF-8"?>
<chapter id="Topology">
	<title>Topology</title>
	<para>The PostGIS Topology types and functions are used to manage topological objects such as faces, edges and nodes.  
	An example of a topologically based GIS database is the <ulink url="http://www.census.gov/geo/www/tiger/overview.html">US Census Topologically Integrated Geographic Encoding and Reference System (TIGER)</ulink> database.
	The PostGIS topology module has existed in prior versions of PostGIS but was never part of the documentation.
	    In PostGIS 2.0.0 major cleanup is going on to remove use of all deprecated functions in it, fix known usability issues, add new functions and enhance to closer conform to SQL-MM standards.</para>
	<para>Details of this project can be found at <ulink url="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgisTopology">PostGIS Tology Wiki</ulink></para>
	<para>All functions and tables associated with this module are installed in a schema called <varname>topology</varname>.</para>
	<para>Functions that are defined in SQL/MM standard are prefixed with ST_ and functions specific to PostGIS are not prefixed.</para>
	<para>To build PostGIS 2.0 with topology support, compile with the --with-topology option as described in <xref linkend="postgis_installation"/>.  Some functions depend on GEOS 3.3+ so you should compile with GEOS 3.3+ to fully utilize the topology support.</para>
	
	<sect1 id="Topology_Types">
        <sect1info>
            <abstract>
                <para>This section lists the PostgreSQL data types installed by PostGIS Topology.  Note we describe the casting behavior of these which is very 
                    important especially when designing your own functions.  
                </para>	
            </abstract>
        </sect1info>
        <title>PostgreSQL PostGIS Topology Types</title>
		
		<refentry id="getfaceedges_returntype">
		  <refnamediv>
			<refname>getfaceedges_returntype</refname>
			<refpurpose>A composite type that consists of a sequence number and edge number.  This is the return type for <varname>ST_GetFaceEdges</varname></refpurpose>
		  </refnamediv>
		  <refsection>
			<title>Description</title>
			<para>A composite type that consists of a sequence number and edge number.  This is the return type for <varname>ST_GetFaceEdges</varname> function.</para>
			<orderedlist>
			  <listitem>
				<para><varname>sequence</varname> is an integer:  Refers to a topology defined in the topology.topology table which defines the topology schema and srid.</para>
			  </listitem>
			  <listitem>
				<para><varname>edge</varname> is an integer: The identifier of an edge.</para>
			  </listitem>
			</orderedlist>
		  </refsection>
		</refentry>
		
		<refentry id="topogeometry">
			  <refnamediv>
				<refname>topogeometry</refname>
				<refpurpose>A composite type that refers to a topology geometry in a specific topology, layer, having specific type (1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection) with specific identifier id in the topology. The id uniquely defines the topogeometry in the topology.</refpurpose>
			  </refnamediv>
			  <refsection>
				<title>Description</title>
				<para>A composite type that refers to a topology geometry in a specific topology, layer, having specific type with specific id. The elements of a topogeometry are the properties: topology_id,layer_id,id integer,type integer. </para>
				<orderedlist>
				  <listitem>
					<para><varname>topology_id</varname> is an integer:  Refers to a topology defined in the topology.topology table which defines the topology schema and srid.</para>
				  </listitem>
				  <listitem>
					<para><varname>layer_id</varname> is an integer: The layer_id in the layers table that hte topogeometry belongs to.  The combination of topology_id, layer_id provides a unique reference in the topology.layers table.</para>
				  </listitem>
				  <listitem>
					<para><varname>type</varname> integer between 1 - 4 that defines the geometry type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</para>
				  </listitem>
				  <listitem>
					<para><varname>id</varname> is an integer: The id is the autogenerated sequence number that uniquely defines the topogeometry in the respective topology.</para>
				  </listitem>
				</orderedlist>
			  </refsection>
			  
			  <refsection>
				<title>Casting Behavor</title>
				<para>This section lists the automatic as well as explicit casts allowed for this data type</para>
				<informaltable rowsep="1" frame="all">
					<tgroup cols="2">
						<tbody>
						  <row>
							<entry>Cast To</entry>
							<entry>Behavior</entry>
						  </row>
						  <row>
							<entry>geometry</entry>
							<entry>automatic</entry>
						  </row>
						</tbody>
					</tgroup>
				</informaltable>
			</refsection>
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="CreateTopoGeom"/></para>
			</refsection>
		</refentry>
		
		<refentry id="validatetopology_returntype">
            <refnamediv>
                <refname>validatetopology_returntype</refname>
                    <refpurpose>A composite type that consists of an error message and id1 and id2 to denote location of error.  This is the return type for <varname>ST_ValidateTopology</varname></refpurpose>
                </refnamediv>
            <refsection>
            <title>Description</title>
            <para>A composite type that consists of an error message and two integers.  The <xref linkend="ValidateTopology" /> function returns a set of these to denote validation errors and the id1 and id2 to denote the ids of the topology objects involved in the error.</para>
                <orderedlist>
                  <listitem>
                    <para><varname>error</varname> is varchar:  Denotes type of error. </para>
                    <para>Current error descriptors are: coincident nodes, edge crosses node, edge not simple, edge end node geometry mis-match, edge start node geometry mismatch, face overlaps face,face within face,  </para>
                  </listitem>
                  <listitem>
                    <para><varname>id1</varname> is an integer: Denotes identifier of edge / face / nodes in error.</para>
                  </listitem>
                 <listitem>
                    <para><varname>id2</varname> is an integer: For errors that involve 2 objects denotes the secondary edge / or node</para>
                  </listitem>
                </orderedlist>
            </refsection>
		  <!-- Optionally add a "See Also" section -->
            <refsection>
                <title>See Also</title>
                <para><xref linkend="ValidateTopology"/></para>
            </refsection>
		</refentry>
	</sect1>
	
	<sect1 id="Topology_Domains">
        <sect1info>
            <abstract>
                <para>This section lists the PostgreSQL domains installed by PostGIS Topology.  Domains can be used like object types as return objects of functions or table columns. The distinction between
                    a domain and a type is that a domain is an existing type with a check constraint bound to it.
                </para>	
            </abstract>
        </sect1info>
        <title>PostgreSQL PostGIS Topology Domains</title>
		
		<refentry id="topoelement">
		  <refnamediv>
			<refname>topoelement</refname>
			<refpurpose>An array of 2 integers generally used to return the element id and element type of a topology relation. </refpurpose>
		  </refnamediv>
		  <refsection>
			<title>Description</title>
			<para>An array of 2 integers generally used to return the element id and element type of a topology relation.</para>
		  </refsection>
            <refsection>
                <title>Examples</title>
                 <programlisting>SELECT ARRAY[1,2]::topology.topoelement;
  te
-------
 {1,2}
                 </programlisting>
                 <programlisting>SELECT ARRAY[1,2,3]::topology.topoelement;
ERROR:  value for domain topology.topoelement violates check constraint "dimensions"
                 </programlisting>
            </refsection>
            <!-- Optionally add a "See Also" section -->
            <refsection>
                <title>See Also</title>
                <para><xref linkend="GetTopoGeomElements"/></para>
            </refsection>
		</refentry>
		
		<refentry id="topoelementarray">
		  <refnamediv>
			<refname>topoelementarray</refname>
			<refpurpose>An array of element_id,element_type values. a bidimensional array of integers: '{{id,type}, {id,type}, ...}'</refpurpose>
		  </refnamediv>
		  <refsection>
			<title>Description</title>
			<para>An array of 1 or more topoelemetns ( a bidimensional array of integers: '{{id,type}, {id,type}, ...}').  So an array of 1 or more arrays each having 2 integers generally used to return an array of sets of element id and element type of a topology relation.</para>
		  </refsection>
            <refsection>
                <title>Examples</title>
                 <programlisting>SELECT '{{1,2},{3,4}}'::topology.topoelementarray As tea;
  tea
-------
{{1,2},{3,4}}

-- more verbose equivalent --
SELECT ARRAY[ARRAY[1,2], ARRAY[3,4]]::topology.topoelementarray As tea;

  tea
-------
{{1,2},{3,4}}

--using the arraya agg function packaged with topology --
SELECT topology.TopoElementArray_Agg(ARRAY[e,t]) As tea
  FROM generate_series(1,3) As e CROSS JOIN generate_series(1,4) As t;
  tea
--------------------------------------------------------------------------
{{1,1},{1,2},{1,3},{1,4},{2,1},{2,2},{2,3},{2,4},{3,1},{3,2},{3,3},{3,4}}
                 </programlisting>
                 <programlisting>SELECT '{{1,2,4},{3,4,5}}'::topology.topoelementarray As tea;
ERROR:  value for domain topology.topoelementarray violates check constraint "dimensions"
                 </programlisting>
            </refsection>
            <!-- Optionally add a "See Also" section -->
            <refsection>
                <title>See Also</title>
                <para><xref linkend="GetTopoGeomElementArray"/>, <xref linkend="TopoElementArray_Agg" /></para>
            </refsection>
		</refentry>
	</sect1>
	
	<sect1 id="Topology_ManagementFunctions">
	    <title>Topology Management Functions</title>
	    <refentry id="AddTopoGeometryColumn">
			<refnamediv>
				<refname>AddTopoGeometryColumn</refname>
				<refpurpose>Adds a topogeometry column to an existing feature table, registers this new column as a layer in topology.layer and returns the new layer_id.</refpurpose>
			</refnamediv>
		
            <refsynopsisdiv>
                <funcsynopsis>
                     <funcprototype>
                        <funcdef>text <function>AddTopoGeometryColumn</function></funcdef>
                        <paramdef><type>varchar </type>
                        <parameter>topology_name</parameter></paramdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>schema_name</parameter></paramdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>table_name</parameter></paramdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>column_name</parameter></paramdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>feature_type</parameter></paramdef>
                    </funcprototype>
                    <funcprototype>
                        <funcdef>text <function>AddTopoGeometryColumn</function></funcdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>topology_name</parameter></paramdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>schema_name</parameter></paramdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>table_name</parameter></paramdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>column_name</parameter></paramdef>
                        
                        <paramdef><type>varchar </type>
                        <parameter>feature_type</parameter></paramdef>
                        
                        <paramdef><type>integer </type>
                        <parameter>child_layar</parameter></paramdef>
                    </funcprototype>
                </funcsynopsis>
            </refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Each TopoGeometry object belongs to a specific Layer of a specific Topology. Before creating a TopoGeometry object you need to create its TopologyLayer. 
                    A Topology Layer is an association of a feature-table with the topology. It also contain type and hierarchy information. We create a layer using the AddTopoGeometryColumn() function: </para>
                <para>This function will both add the requested column to the table and add a record to the topology.layer table with all the given info.</para>
                <para>If you don't specify [child_layer] (or set it to NULL) this layer would contain Basic TopoGeometries (composed by primitive topology elements). 
                    Otherwise this layer will contain hierarchical TopoGeometries (composed by TopoGeometries from the child_layer).</para>
    
                <para>Once the layer is created (it's id is returned by the AddTopoGeometryColumn function) you're ready to construct TopoGeometry objects in it</para>
                <para>Valid <varname>feature_type</varname>s are: POINT, LINE, POLYGON, COLLECTION</para> 
        
                <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>-- Note for this example we created our new table in the ma_topo schema 
-- though we could have created it in a different schema -- in shich case topology_name and schema_name would be different 
CREATE SCHEMA ma;
CREATE TABLE ma.parcels(gid serial, parcel_id varchar(20) PRIMARY KEY, address text);
SELECT topology.AddTopoGeometryColumn('ma_topo', 'ma', 'parcels', 'topo', 'POLYGON');</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
			
				<para><xref linkend="CreateTopology"/></para>
			</refsection>
		</refentry>
		<refentry id="CreateTopology">
			<refnamediv>
				<refname>CreateTopology</refname>
				<refpurpose>Creates a new topology schema and registers this new schema in the topology.topology table.</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
						<funcdef>integer <function>CreateTopology</function></funcdef>
						<paramdef><type>varchar </type> <parameter>topology_schema_name</parameter></paramdef>
					</funcprototype>
					
					<funcprototype>
						<funcdef>integer <function>CreateTopology</function></funcdef>
						<paramdef><type>varchar </type> <parameter>topology_schema_name</parameter></paramdef>
						<paramdef><type>integer </type> <parameter>srid</parameter></paramdef>
					</funcprototype>
		
					<funcprototype>
						<funcdef>integer <function>CreateTopology</function></funcdef>
						<paramdef><type>varchar </type> <parameter>topology_schema_name</parameter></paramdef>
						<paramdef><type>integer </type> <parameter>srid</parameter></paramdef>
						<paramdef><type>double precision </type> <parameter>tolerance</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Creates a new schema with name <varname>topology_name</varname> consisting of tables (<varname>edge_data</varname>,<varname>face</varname>,<varname>node</varname>, <varname>relation</varname>
                    and registers this new topology in the topology.topology table. It returns the id of the topology in the topology table. The srid is the spatial reference identified as 
                defined in spatial_ref_sys table for that topology.  Toplogies must be uniquely named.  The tolerance is measured in the units of the spatial reference system.  If the tolerance is not specified defaults to 0.</para>
        
                <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<para>This example creates a new schema called ma_topo that will store edges, faces, and relations in Massachusetts State Plane meters.
					The tolerance represents 1/2 meter since the spatial reference system is a meter based spatial reference system</para>
				<programlisting>SELECT topology.CreateTopology('ma_topo',26986, 0.5);</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
			
				<para><xref linkend="spatial_ref_sys"/></para>
			</refsection>
		</refentry>
		<refentry id="DropTopology">
			<refnamediv>
				<refname>DropTopology</refname>
			
				<refpurpose>Use with caution: Drops a topology schema and deletes its reference from  topology.topology table and references to tables in that schema from the geometry_columns table.</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>integer <function>DropTopology</function></funcdef>
					<paramdef><type>varchar </type> <parameter>topology_schema_name</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Drops a topology schema and deletes its reference from topology.topology table and references to tables in that schema from the geometry_columns table.
                This function should be USED WITH CAUTION, as it could destroy data you care about.  If the schema does not exist, it just removes reference entries the named schema.</para>
        
                <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<para>Cascade drops the ma_topo schema and removes all references to it in topology.topology and geometry_columns.</para>
				<programlisting>SELECT topology.DropTopology('ma_topo');</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para></para>
			</refsection>
		</refentry>
		<refentry id="DropTopoGeometryColumn">
			<refnamediv>
				<refname>DropTopoGeometryColumn</refname>
			
				<refpurpose>Drops the topogeometry column from the table named <varname>table_name</varname> in schema <varname>schema_name</varname> and unregisters the columns from topology.layer table.</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>text <function>DropTopoGeometryColumn</function></funcdef>
					<paramdef><type>varchar </type> <parameter>schema_name</parameter></paramdef>
					<paramdef><type>varchar </type> <parameter>table_name</parameter></paramdef>
					<paramdef><type>varchar </type> <parameter>column_name</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Drops the topogeometry column from the table named <varname>table_name</varname> in schema <varname>schema_name</varname> and unregisters the columns from topology.layer table. Returns summary
                of drop status.  NOTE: it first sets all values to NULL before dropping to bypass referential integrity checks.</para>
        
                <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>SELECT topology.DropTopoGeometryColumn('ma_topo', 'parcel_topo', 'topo');</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="AddTopoGeometryColumn"/></para>
			</refsection>
		</refentry>
		
		<refentry id="ValidateTopology">
			<refnamediv>
				<refname>ValidateTopology</refname>
			
				<refpurpose>Returns a set of validatetopology_returntype objects detailing issues with topology</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>setof validatetopology_returntype <function>ValidateTopology</function></funcdef>
					<paramdef><type>varchar </type> <parameter>topology_schema_name</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Returns a set of <xref linkend="validatetopology_returntype"/> objects detailing issues with topology. Refer to 
                   <xref linkend="validatetopology_returntype"/> for listing of possible errors.</para>
        
                <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>SELECT * FROM  topology.ValidateTopology('ma_topo');
      error        | id1 | id2
-------------------+-----+-----
face without edges |   0 |				
				</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="validatetopology_returntype"/></para>
			</refsection>
		</refentry>
	</sect1>
	<sect1 id="Topology_Constructors">
	  <title>TopoGeometry and other Topology Object Constructors</title>
	     <refentry id="AddEdge">
			<refnamediv>
				<refname>AddEdge</refname>
			
				<refpurpose>Adds a linestring edge to the edge table and associated nodes to the point nodes table of the specified topology schema using the specified linestring geometry and returns the edgeid of the new record.</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>integer <function>AddEdge</function></funcdef>
					<paramdef><type>varchar </type> <parameter>toponame</parameter></paramdef>
					<paramdef><type>geometry </type> <parameter>aline</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Adds an edge to the edge table and associated nodes to the nodes table of the specified <varname>toponame</varname> schema using the specified linestring geometry and returns the edgeid of the new record. 
                The newly added edge has "universe" face on both sides and links to itself.</para>
                <note><para>If the <varname>aline</varname> geometry crosses an existing linestring edge, or intersects an existing not at the endpoints, then an error is thrown and the edge is not added.</para></note>
                 <note><para>The geometry of <varname>aline</varname> must be have the same <varname>srid</varname> as defined for the topology otherwise an invalid spatial reference sys error will be thrown.</para></note>
        
        
                <!-- use this format if new function -->
                <para>Availability: 2.0.0 requires GEOS &gt;= 3.3.0.</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227575.8 893917.2,227591.9 893900.4)', 26986) ) As edgeid;
-- result-
edgeid
--------
 1
				
SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.9 893900.4,227622.6 893844.2,227641.6 893816.5,227704.5 893778.5)', 26986) ) As edgeid;
-- result --
edgeid
--------
 2
 
 SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.2 893900, 227591.9 893900.4,227704.5 893778.5)', 26986) ) As edgeid;
 -- gives error --
 ERROR:  Edge intersects (not on endpoints) with existing edge 1
</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="CreateTopology"/></para>
			</refsection>
		</refentry>		
		
		<refentry id="AddFace">
			<refnamediv>
				<refname>AddFace</refname>
			
				<refpurpose>Adds a polygon to the faces table in the specified topology schema and returns the faceid of new face. 
				    If face already exists the id of the existing face is returned. Edges of the polygon must already exist otherwise an error is thrown.</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>integer <function>AddFace</function></funcdef>
					<paramdef><type>varchar </type> <parameter>toponame</parameter></paramdef>
					<paramdef><type>geometry </type> <parameter>apolygon</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Add a face primitive to a topology and get it's identifier. For a newly added face, its edges will be appropriately linked (marked as left-face or right-face).</para>
                <para>The target topology is assumed to be valid (containing no self-intersecting edges). An exception is raised if: The polygon boundary is not fully defined by existing edges or the polygon overlaps an existing face.</para>
                <note><para>If the <varname>apolygon</varname> geometry already exists as a face the face id of the existing face is returned.</para></note>
                
                <!-- use this format if new function -->
                <para>Availability: 2.0.0</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>
-- first add the edges we use generate_series as an iterator (the below will only work for polygons with &lt; 10000 points because of our max in gs) 
SELECT topology.AddEdge('ma_topo', ST_MakeLine(ST_PointN(geom,i), ST_PointN(geom, i + 1) )) As edgeid
    FROM (SELECT  ST_NPoints(geom) AS npt, geom
            FROM 
                (SELECT ST_Boundary(ST_GeomFromText('POLYGON((234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,234891 899285.4,234992.5 899145,
    234890.6 899069,234755.2 899255.4,234612.7 899379.4,234776.9 899563.7,234896.5 899456.7))', 26986) )  As geom
            )  As geoms) As facen CROSS JOIN generate_series(1,10000) As i
         WHERE i &lt; npt;
-- result --
 edgeid
--------
      3
      4
      5
      6
      7
      8
      9
     10
     11
     12
(10 rows)
-- then add the face -
				
SELECT topology.AddFace('ma_topo', 
    ST_GeomFromText('POLYGON((234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,234891 899285.4,234992.5 899145,
    234890.6 899069,234755.2 899255.4,234612.7 899379.4,234776.9 899563.7,234896.5 899456.7))', 26986) ) As faceid;
-- result --
faceid
--------
 1
 
</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="AddEdge"/>, <xref linkend="CreateTopology"/></para>
			</refsection>
		</refentry>
		
		<refentry id="AddNode">
			<refnamediv>
				<refname>AddNode</refname>
			
				<refpurpose>Adds a point node to the nodes table in the specified topology schema and returns the nodeid of new node. If point already exists as node, the existing nodeid is returned.</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>integer <function>AddNode</function></funcdef>
					<paramdef><type>varchar </type> <parameter>toponame</parameter></paramdef>
					<paramdef><type>geometry </type> <parameter>apoint</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Adds a point node to the nodes table in the specified topology schema.  The <xref linkend="AddEdge" /> function automatically adds start and end points of an edge when called so not necessary to explicitly add nodes of an edge.
                When adding a new node it checks for the existance of any edge crossing the given point, raising an exception if found.</para>
                <note><para>If the <varname>apoint</varname> geometry already exists as a node, the node is not added but the existing nodeid is returned.</para></note>
                
                <!-- use this format if new function -->
                <para>Availability: 2.0.0</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>SELECT topology.AddNode('ma_topo', ST_GeomFromText('POINT(227641.6 893816.5)', 26986) ) As nodeid;

				
SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.9 893900.4,227622.6 893844.2,227641.6 893816.5,227704.5 893778.5)', 26986) ) As edgeid;
-- result --
nodeid
--------
 4
 
</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="AddEdge"/>, <xref linkend="CreateTopology"/></para>
			</refsection>
		</refentry>
		
	  	<refentry id="CreateTopoGeom">
			<refnamediv>
				<refname>CreateTopoGeom</refname>
			
				<refpurpose>Creates a new topo geometry object from topo element array - tg_type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>topogeometry <function>CreateTopoGeom</function></funcdef>
					<paramdef><type>varchar </type> <parameter>toponame</parameter></paramdef>
					<paramdef><type>integer </type> <parameter>tg_type</parameter></paramdef>
					<paramdef><type>integer</type> <parameter>layer_id</parameter></paramdef>
					<paramdef><type>topoelementarray</type> <parameter>tg_objs</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Creates a topo geometry object for layer denoted by layer_id and registers it in the relations table in tho <varname>toponame</varname> schema.</para>
                <para>tg_type is an integer: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection. layer_id is the layer id in the topology.layer table.</para>
        
                <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting></programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="AddTopoGeometryColumn"/></para>
			</refsection>
		</refentry>
		
		<refentry id="TopoElementArray_Agg">
          <refnamediv>
            <refname>TopoElementArray_Agg</refname>
            <refpurpose>Returns a <varname>topoelementarray</varname> for a set of element_id, type arrays (topoelements)</refpurpose>
          </refnamediv>
        
          <refsynopsisdiv>
            <funcsynopsis>
              <funcprototype>
                <funcdef>topoelementarray <function>TopoElementArray_Agg</function></funcdef>
                <paramdef><type>topoelement set</type> <parameter>tefield</parameter></paramdef>
              </funcprototype>
            </funcsynopsis>
          </refsynopsisdiv>
          
          	<refsection>
                <title>Description</title>
            
                <para>Used to create a <xref linkend="topoelementarray" /> from a set of <xref linkend="topoelement" />.</para>
                
                <!-- use this format if new function -->
                <para>Availability: 2.0.0</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>SELECT topology.TopoElementArray_Agg(ARRAY[e,t]) As tea
  FROM generate_series(1,3) As e CROSS JOIN generate_series(1,4) As t;
  tea
--------------------------------------------------------------------------
{{1,1},{1,2},{1,3},{1,4},{2,1},{2,2},{2,3},{2,4},{3,1},{3,2},{3,3},{3,4}}</programlisting>
			</refsection>
			<refsection>
				<title>See Also</title>
				<para><xref linkend="topoelement"/>,<xref linkend="topoelementarray"/></para>
			</refsection>
          </refentry>
	</sect1>
	
	<sect1 id="Topology_Accessors">
	  <title>TopoGeometry and other Topology Object Accessors</title>
	      <refentry id="GetTopoGeomElementArray">
			<refnamediv>
				<refname>GetTopoGeomElementArray</refname>
			
				<refpurpose>Returns a <varname>topoelementarray</varname> (an array of topoelements) containing the topological elements and type of the given TopoGeometry (primitive elements)</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>topoelementarray <function>GetTopoGeomElementArray</function></funcdef>
					<paramdef><type>varchar </type> <parameter>toponame</parameter></paramdef>
					<paramdef><type>integer </type> <parameter>layer_id</parameter></paramdef>
					<paramdef><type>integer</type> <parameter>tg_id</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
				<funcsynopsis>
					<funcprototype>
					<funcdef>topoelementarray topoelement <function>GetTopoGeomElementArray</function></funcdef>
					<paramdef><type>topogeometry </type> <parameter>tg</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Returns a <xref linkend="topoelementarray"/> containing the topological elements and type of the given TopoGeometry (primitive elements).  This is similar to GetTopoGeomElements except it returns the elements as an array rather
                than as a dataset.</para>
                <para>tg_id is the topogeometry id of the topogeometry object in the topology in the layer denoted by <varname>layer_id</varname> in the topology.layer table.</para>
        
                <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<!-- TODO: -->
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="GetTopoGeomElements"/>,<xref linkend="topoelementarray"/></para>
			</refsection>
		</refentry>
	  	<refentry id="GetTopoGeomElements">
			<refnamediv>
				<refname>GetTopoGeomElements</refname>
			
				<refpurpose>Returns a set of <varname>topoelement</varname> objects containing the topological  element_id,element_type of the given TopoGeometry (primitive elements)</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>setof topoelement <function>GetTopoGeomElements</function></funcdef>
					<paramdef><type>varchar </type> <parameter>toponame</parameter></paramdef>
					<paramdef><type>integer </type> <parameter>layer_id</parameter></paramdef>
					<paramdef><type>integer</type> <parameter>tg_id</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
				<funcsynopsis>
					<funcprototype>
					<funcdef>setof topoelement <function>GetTopoGeomElements</function></funcdef>
					<paramdef><type>topogeometry </type> <parameter>tg</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Returns a set of element_id,element_type (topoelements) for a given topogeometry object in <varname>toponame</varname> schema.</para>
                <para>tg_id is the topogeometry id of the topogeometry object in the topology in the layer denoted by <varname>layer_id</varname> in the topology.layer table.</para>
        
                <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<!-- TODO: -->
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="GetTopoGeomElementArray"/>,<xref linkend="topoelement"/></para>
			</refsection>
		</refentry>
		
		<refentry id="GetTopologyID">
			<refnamediv>
				<refname>GetTopologyID</refname>
			
				<refpurpose>Returns the id of a topology in the topology.topology table given the name of the topology.</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>integer <function>GetTopologyID</function></funcdef>
					<paramdef><type>varchar</type> <parameter>toponame</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Returns the id of a topology in the topology.topology table given the name of the topology.</para>
              <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>SELECT topology.GetTopologyID('ma_topo') As topo_id;
 topo_id
---------
       1</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="CreateTopology"/>, <xref linkend="DropTopology"/>, <xref linkend="GetTopologyName"/></para>
			</refsection>
		</refentry>
		
		<refentry id="GetTopologyName">
			<refnamediv>
				<refname>GetTopologyName</refname>
			
				<refpurpose>Returns the name of a topology (schema) given the id of the topology.</refpurpose>
			</refnamediv>
		
			<refsynopsisdiv>
				<funcsynopsis>
					<funcprototype>
					<funcdef>varchar <function>GetTopologyName</function></funcdef>
					<paramdef><type>integer</type> <parameter>topology_id</parameter></paramdef>
					</funcprototype>
				</funcsynopsis>
			</refsynopsisdiv>
		
			<refsection>
                <title>Description</title>
            
                <para>Returns the topology name (schema) of a topology from the topology.topology table given the topology id of the topology.</para>
              <!-- use this format if new function -->
                <para>Availability: 1.?</para>
			</refsection>
		
		
			<refsection>
				<title>Examples</title>
				<programlisting>SELECT topology.GetTopologyName(1) As topo_name;
 topo_name
-----------
 ma_topo</programlisting>
			</refsection>
		
			<!-- Optionally add a "See Also" section -->
			<refsection>
				<title>See Also</title>
				<para><xref linkend="CreateTopology"/>, <xref linkend="DropTopology"/>,<xref linkend="GetTopologyID"/></para>
			</refsection>
		</refentry>
	</sect1>
</chapter>